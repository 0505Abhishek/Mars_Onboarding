<%- include("../shared/header.ejs") %>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<style>
.modal-backdrop {
    display: none !important;
}

.modal-body {
    max-height: 440px; /* Set max height */
    overflow-y: auto; /* Enable scrolling */
}

     table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        input[type="file"] {
            display: none;
        }
        td input[type="text"] {
            width: 100%;
        }
        .upload-icon {
            cursor: pointer;
            font-size: 20px;
        }
        .view-icon {
            cursor: pointer;
            font-size: 20px;
            display: none;
        }

</style>
  <style>

    .table-dark th {
        color: #0000A0 !important; 
        background-color: #E0E0FC;
        border: 1px solid rgb(224, 203, 203);
    }

    #distributorTable tbody tr:nth-child(odd) td {
        background: #FFFFFF !important; 
    }

    #distributorTable tbody tr:nth-child(even) td {
        background: #EFEFFF !important; 
    }
</style>


   
<div class="container mt-4">
    <h5 class="mb-4" style="color: #41378d;">Distributor List</h5>

    <div class="table-responsive">
        <table id="documentTable">
            <thead>
                <tr>
                    <th>S. No.</th>
                    <th>Document Name</th>
                    <th>Upload</th>
                    <th>View</th>
                    <th>Remarks</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>Doc 1</td>
                    <td>
                        <label for="file1" class="upload-icon">üì§</label>
                        <input type="file" id="file1" class="file-upload" data-view="view1">
                    </td>
                    <td>
                        <span id="view1" class="view-icon">üëÅ</span>
                    </td>
                    <td>
                        <input type="text" placeholder="Enter remarks">
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Doc 2</td>
                    <td>
                        <label for="file2" class="upload-icon">üì§</label>
                        <input type="file" id="file2" class="file-upload" data-view="view2">
                    </td>
                    <td>
                        <span id="view2" class="view-icon">üëÅ</span>
                    </td>
                    <td>
                        <input  style="width:100%" type="text" placeholder="Enter remarks">
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>


<div class="modal" id="fileModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Modal title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body text-center">
            <div id="filePreview"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary">Save changes</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script>
 document.addEventListener("DOMContentLoaded", function () {
    const fileInputs = document.querySelectorAll(".file-upload");
    const viewIcons = document.querySelectorAll(".view-icon");
    const modalElement = document.getElementById("fileModal");
    const modalBody = document.getElementById("filePreview");
    const closeModalBtn = modalElement.querySelector("[data-dismiss='modal']"); 

    let modalInstance = new bootstrap.Modal(modalElement);

    fileInputs.forEach((input) => {
        input.addEventListener("change", function () {
            const viewId = this.dataset.view;
            const file = this.files[0];

            if (file) {
                const fileUrl = URL.createObjectURL(file);
                const viewIcon = document.getElementById(viewId);

                if (viewIcon) {
                    viewIcon.dataset.file = fileUrl;
                    viewIcon.dataset.type = file.type;
                    viewIcon.style.display = "inline";
                }
            }
        });
    });

    viewIcons.forEach((icon) => {
    icon.addEventListener("click", function () {
        const fileUrl = this.dataset.file;
        const fileType = this.dataset.type;

        if (fileUrl && fileType) {
            if (fileType.startsWith("image")) {
                modalBody.innerHTML = `<img src="${fileUrl}" style="width: 100%; height: auto;">`;
            } else if (fileType === "application/pdf") {
                modalBody.innerHTML = `
                    <embed src="${fileUrl}" type="application/pdf" width="100%" height="500px" />
                `;
            } else {
                modalBody.innerHTML = `<p>Unsupported file type</p>`;
            }

            modalInstance.show();
        }
    });
});


    // Ensure modal closes properly
    closeModalBtn.addEventListener("click", function () {
        modalInstance.hide();
    });

    // SweetAlert notification
    <% if (notification) { %>
        Swal.fire({
            icon: '<%= notification.type %>', 
            title: '<%= notification.message %>',
            showConfirmButton: false,
            timer: 2000
        });
    <% } %>
});


   </script>


<%- include("../shared/footer.ejs") %>
